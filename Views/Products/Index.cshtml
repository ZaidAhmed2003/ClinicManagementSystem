@model IEnumerable<ClinicManagementSystem.Models.ProductModel>

@{
	ViewData["Title"] = "Index";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
	ViewData["Title"] = "Index";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid mt-2">
	<div class="row">
		<div class="col-lg-2"></div>
		<div class="col-md-10">
			<div class="row">
				@foreach (var product in Model)
				{
					<div>
						<h3>@product.Name</h3>
						<p>Price: @product.Price</p>
						<form method="post" asp-controller="Cart" asp-action="AddToCart">
							<input type="hidden" name="productId" value="@product.ProductId" />
							<input type="number" name="quantity" value="1" min="1" />
							<button type="submit">Add to Cart</button>
						</form>
					</div>
				}

			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Add event listeners to all "Add to Cart" buttons
		document.querySelectorAll('.add-to-cart').forEach(button => {
			button.addEventListener('click', async function () {
				const productId = this.getAttribute('data-product-id');
				const quantity = 1; // Default quantity

				try {
					const response = await fetch('/Cart/AddToCart', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'X-CSRF-TOKEN': '@(Html.AntiForgeryToken())'
						},
						body: JSON.stringify({ productId, quantity })
					});

					if (response.ok) {
						const result = await response.json();
						alert(result.message); // Show success message
					} else {
						const error = await response.json();
						alert(error.message); // Show error message
					}
				} catch (error) {
					console.error('Error adding to cart:', error);
					alert('An error occurred while adding to cart.');
				}
			});
		});
	});</script>